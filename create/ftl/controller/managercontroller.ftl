<#include "../function.ftl">package ${packname}.controller.manager;import java.util.Map;import java.util.List;import java.util.ArrayList;import ${packname}.controller.ManagerController;import ${packname}.entity.runtime.ResponseErrorMsg;<@getImport cols packname refCols joinTables /><@genJoinAndRefImport joinTables refCols  /><#assign tableKeyStr><@compress><@getTableKey cols/></@compress></#assign><#assign tableKeyParamStr><@compress><@getTableKeyParamFirst cols/></@compress></#assign><#assign tablePrimaryKeyColumnType><@getTableKeyType cols /></#assign><#assign colInteger>${checkColTypeIsToJavaNotString(tablePrimaryKeyColumnType)?string}</#assign>@Controller	/** ${name} */@RequestMapping("/mg/${tab?lower_case}")public class ${tab}ManagerController extends ManagerController {		Logger logger = LogManager.getLogger(${tab}ManagerController.class.getName());		protected ModelAndView mv = new ModelAndView();		public static String path = "${tab?lower_case}/";		@Resource	private ${tab}Service ${tab?uncap_first}Svc;		<@genJoinAndRefService joinTables refCols  />		RequestParamBeanLoader rpbl = new RequestParamBeanLoader();<#if (!code?starts_with("SQLVW_") && !code?starts_with("SQLVVW_"))>	@Login(value=LoginResultReturnType.page,reqFromType=LoginRequestFromType.manager)	@RequestMapping(value = {"/new","/new/dialog"})	public ModelAndView add(){		<#-- <@genOptionAddObject joinTables />  生成导入Select 数据的代码，已经改为页面通过Ajax引用，暂不需要。 -->		mv.setViewName(ManagerController.path + ${tab}ManagerController.path + "${tab?lower_case}_add");		return mv;	}		@Login(value=LoginResultReturnType.page,reqFromType=LoginRequestFromType.manager)	@RequestMapping(value="/save")	public ModelAndView save(HttpServletRequest request){		${tab}Vojo  ${tab?uncap_first}Upd = new ${tab}Vojo();		rpbl.load(${tab?uncap_first}Upd,request);		Map<String,Object> checkResultMap = ${tab?uncap_first}Upd.checkLength(${tab?uncap_first}Upd);		if(!(Boolean) checkResultMap.get("result")){			mv.addObject("msg", ResponseErrorMsg.PARAMER_EMPTY.getError_msg() + "：" + checkResultMap.get("msg"));			mv.setViewName("redirect:/500");		}else{			<#if colInteger=='true'>			if(<#list cols as col><#if col.primaryKey>null==${tab?uncap_first}Upd.get<@getTableKeyForSetGet cols/>()<#break></#if></#list>){				<#-- ${tab?uncap_first}Upd.setCreateTime(new Date());有创建时间、更新时间项目使用，其他项目可删除 -->				${tab?uncap_first}Svc.add${tab}(${tab?uncap_first}Upd);			}else{				if(null!=${tab?uncap_first}Upd.get<@getTableKeyForSetGet cols/>Mults()){					for(int i<@getTableKeyForSetGet cols/>=0;i<@getTableKeyForSetGet cols/><${tab?uncap_first}Upd.get<@getTableKeyForSetGet cols/>Mults().length;i<@getTableKeyForSetGet cols/>++){						${tab?uncap_first}Upd.set<@getTableKeyForSetGet cols/>((Integer) ${tab?uncap_first}Upd.get<@getTableKeyForSetGet cols/>Mults()[i<@getTableKeyForSetGet cols/>]);						${tab?uncap_first}Svc.upd${tab}ByPrimaryKey(${tab?uncap_first}Upd);					}				}else{					<#-- ${tab?uncap_first}Upd.setUpdateTime(new Date());有创建时间、更新时间项目使用，其他项目可删除 -->					${tab?uncap_first}Svc.upd${tab}ByPrimaryKey(${tab?uncap_first}Upd);	//				${tab}Vojo  ${tab?uncap_first} = new ${tab}Vojo();		//更新数据过滤条件	//				${tab?uncap_first}Svc.upd${tab}ByFilter(${tab?uncap_first}Upd,${tab?uncap_first});				}			}			<#else>			if(StringUtils.isBlank(${tab?uncap_first}Upd.get<@getTableKeyForSetGet cols/>())){				<#list cols as col><#if col.primaryKey >${tab?uncap_first}Upd.set<@getTableKeyForSetGet cols/>(Utils.shortUUIDRandom());<#break></#if></#list>				<#-- ${tab?uncap_first}Upd.setCreateTime(new Date());有创建时间、更新时间项目使用，其他项目可删除 -->				${tab?uncap_first}Svc.add${tab}(${tab?uncap_first}Upd);			}else{				if(null!=${tab?uncap_first}Upd.get<@getTableKeyForSetGet cols/>()){					for(String t<@getTableKeyForSetGet cols/> : ${tab?uncap_first}Upd.get<@getTableKeyForSetGet cols/>().split(",")){						<#list cols as col><#if col.primaryKey >${tab?uncap_first}Upd.set<@getTableKeyForSetGet cols/>(t<@getTableKeyForSetGet cols/>);<#break></#if></#list>						${tab?uncap_first}Svc.upd${tab}ByPrimaryKey(${tab?uncap_first}Upd);						<#-- ${tab?uncap_first}Upd.setUpdateTime(new Date());有创建时间、更新时间项目使用，其他项目可删除 -->		//				${tab}Vojo  ${tab?uncap_first} = new ${tab}Vojo();		//更新数据过滤条件		//				${tab?uncap_first}Svc.upd${tab}ByFilter(${tab?uncap_first}Upd,${tab?uncap_first});					}				}			}			</#if>			mv.setViewName("redirect:/mg/${tab?lower_case}");		}		return mv;	}</#if>	@Login(value=LoginResultReturnType.page,reqFromType=LoginRequestFromType.manager)	@RequestMapping(value={"","/","/dialog"})	public ModelAndView list(HttpServletRequest request){		<#-- <@genOptionAddObject joinTables />  生成导入Select 数据的代码，已经改为页面通过Ajax引用，暂不需要。 -->		Pagination page = new Pagination();		${tab}Vojo  ${tab?uncap_first} = new ${tab}Vojo();		rpbl.load(${tab?uncap_first},request);		rpbl.load(page,request);		<#if (joinTables?size>0)>		if(StringUtils.isBlank(${tab?uncap_first}.getSearchKey()) || null == ${tab?uncap_first}.getSearchCols() || ${tab?uncap_first}.getSearchCols().length()==0)			page =  ${tab?uncap_first}Svc.getAll${tab}ByPageWithJoin(page,  ${tab?uncap_first});		else{			List<String> searchColList = new ArrayList<String>();			for(String searchCol:${tab?uncap_first}.getSearchCols().split(",")){				if(${tab}.columMap.containsKey(searchCol))					searchColList.add(searchCol);			}			page = ${tab?uncap_first}Svc.getAll${tab}ByPageAndSearchKeyWithJoin(page, ${tab?uncap_first}, searchColList);		}//		List<${tab}> resultSk = ${tab?uncap_first}Svc.getAll${tab}BySearchKey(${tab?uncap_first}, searchColList);//		List<${tab}> resultSkJ = ${tab?uncap_first}Svc.getAll${tab}BySearchKeyWithJoin(${tab?uncap_first}, searchColList);		<#else>		if(StringUtils.isBlank(${tab?uncap_first}.getSearchKey()) || null == ${tab?uncap_first}.getSearchCols() || ${tab?uncap_first}.getSearchCols().length()==0)			page =  ${tab?uncap_first}Svc.getAll${tab}ByPage(page,  ${tab?uncap_first});		else{			List<String> searchColList = new ArrayList<String>();			for(String searchCol:${tab?uncap_first}.getSearchCols().split(",")){				if(${tab}.columMap.containsKey(searchCol))					searchColList.add(searchCol);			}			page = ${tab?uncap_first}Svc.getAll${tab}ByPageAndSearchKey(page, ${tab?uncap_first}, searchColList);		}//		List<${tab}> resultSk = ${tab?uncap_first}Svc.getAll${tab}BySearchKey(${tab?uncap_first}, searchColList);		</#if>		mv.addObject("page", page);		mv.addObject("${tab?uncap_first}", ${tab?uncap_first});		mv.setViewName(ManagerController.path + ${tab}ManagerController.path + "${tab?lower_case}_list");		return mv;	}<#if (!code?starts_with("SQLVW_") && !code?starts_with("SQLVVW_"))>		@Login(value=LoginResultReturnType.page,reqFromType=LoginRequestFromType.manager)	@RequestMapping(value={"/<@compress>{<@getTableKey cols/>}/modify","/{<@getTableKey cols/>}/modify/dialog"})</@compress>	public ModelAndView modify(@PathVariable("${tableKeyStr}")${tableKeyParamStr}){		<#-- <@genOptionAddObject joinTables />  生成导入Select 数据的代码，已经改为页面通过Ajax引用，暂不需要。 -->		${tab}Vojo  ${tab?uncap_first} = new ${tab}Vojo(${tab?uncap_first}Svc.get${tab}ByPrimaryKey(${tableKeyStr}));		mv.addObject("${tab?uncap_first}", ${tab?uncap_first});		mv.setViewName(ManagerController.path + ${tab}ManagerController.path + "${tab?lower_case}_modify");		return mv;	}</#if>		@Login(value=LoginResultReturnType.page,reqFromType=LoginRequestFromType.manager)	@RequestMapping(value={"/<@compress>{<@getTableKey cols/>}","/{<@getTableKey cols/>}/dialog"})</@compress>	public ModelAndView show(@PathVariable("${tableKeyStr}")${tableKeyParamStr}	,HttpServletRequest request){		<#if (joinTables?size>0)>		${tab}Vojo  ${tab?uncap_first} = new ${tab}Vojo(${tab?uncap_first}Svc.get${tab}ByPrimaryKeyWithJoin(new ${tab}Extend(new ${tab}(${tableKeyStr}))));		<#else>		${tab}Vojo  ${tab?uncap_first} = new ${tab}Vojo(${tab?uncap_first}Svc.get${tab}ByPrimaryKey(${tableKeyStr}));		</#if>		<#if (refCols?size>0)><#list refCols as col>		<#if (col.typeExpend?upper_case=="LIST")>		${tab?uncap_first}Svc.add<@genAttributeByForSetAndGet colName_ABFSAG='${col.code}'/>(${tab?uncap_first},new ${col.type}(),new Pagination());		<#else>		${tab?uncap_first}Svc.add<@genAttributeByForSetAndGet colName_ABFSAG='${col.code}'/>(${tab?uncap_first});		</#if>		</#list></#if>		mv.addObject("${tab?uncap_first}", ${tab?uncap_first});		mv.setViewName(ManagerController.path + ${tab}ManagerController.path + "${tab?lower_case}_show");		return mv;	}<#if (!code?starts_with("SQLVW_") && !code?starts_with("SQLVVW_"))>			@Login(value=LoginResultReturnType.page,reqFromType=LoginRequestFromType.manager)	@RequestMapping(value="/del")	public ModelAndView del(HttpServletRequest request){		${tab}Vojo  ${tab?uncap_first}Upd = new ${tab}Vojo();		rpbl.load(${tab?uncap_first}Upd,request);	<#if colInteger=='true'>		if(null!=${tab?uncap_first}Upd.get<@getTableKeyForSetGet cols/>Mults()){			for(int i<@getTableKeyForSetGet cols/>=0;i<@getTableKeyForSetGet cols/><${tab?uncap_first}Upd.get<@getTableKeyForSetGet cols/>Mults().length;i<@getTableKeyForSetGet cols/>++){//				${tab?uncap_first}Svc.del${tab}ByPrimaryKey(i<@getTableKeyForSetGet cols/>);			}		}else{//			${tab?uncap_first}Svc.del${tab}ByPrimaryKey(${tab?uncap_first}Upd.get<@getTableKeyForSetGet cols/>());		}	<#else>		for(String t<@getTableKeyForSetGet cols/> : ${tab?uncap_first}Upd.get<@getTableKeyForSetGet cols/>().split(",")){			${tab?uncap_first}Svc.del${tab}ByPrimaryKey(t<@getTableKeyForSetGet cols/>);		}	</#if>//		${tab?uncap_first}Svc.del${tab}ByFilter(${tableKeyStr});		mv.setViewName("redirect:/mg/${tab?lower_case}");		return mv;	}</#if>	}